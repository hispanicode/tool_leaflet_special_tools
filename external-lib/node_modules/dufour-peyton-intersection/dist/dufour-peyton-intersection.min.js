(()=>{var t={155:t=>{t.exports=function(t){const e=t=>Array.isArray(t)||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof BigInt64Array||t instanceof BigUint64Array;let n=0,o=t;for(;e(o);)n++,o=o[0];return n}},230:(t,e,n)=>{const o=n(557),r=n(240),s=n(734),i=n(443),c=n(614),a=n(666),l=n(360),u=n(955),f=n(250),h=n(732),p=n(578),x=n(559);t.exports=function({debug_level:t=0,raster_bbox:e,raster_height:n,raster_width:g,pixel_height:d,pixel_width:m,geometry:y,per_pixel:w,per_row_segment:_}){const[v,A,b,L]=e,E=[];if(0!==n){for(let t=0;t<n;t++){const e=L-d*t-d/2,n=o([v,e],[v+1,e]);E.push(n)}t>=2&&console.log("[dufour-peyton-intersection] imageLines:",E),u(y).map(a).forEach((a=>{const u=x(n).map((()=>[])),y=a.length;for(let t=0;t<y;t++){const r=a[t],[i,c]=r,[f,h]=i,[p,x]=c,g=Math.sign(x-h),m=h===x,y=f===p,w=h,_=o(i,c),v=Math.min(h,x),A=Math.max(h,x);let b,L,M,I;if(f<p?([b,L]=i,[I,M]=c):([b,L]=c,[I,M]=i),void 0===b)throw Error("startLng is "+b);const O=Math.round((e[3]-.5*d-L)/d),z=Math.round((e[3]-.5*d-M)/d);let F,N;O<z?(F=O,N=z):(F=z,N=O),F=s(F,0,n-1),N=s(N,0,n-1);for(let e=F;e<N+1;e++){const n=E[e];if(void 0===n)throw console.error("j:",e),console.error("imageLines:",E),Error("imageLines");const o=-1*n.c,s=h===o,i=x===o,c=!i;let a,d;if(m){if(w!==o)continue;a=b,d=I}else if(y)o>=v&&o<=A&&(a=b,d=I);else if(s)a=d=f;else if(i)a=d=p;else try{a=d=l(_,n).x}catch(t){throw t}void 0!==a&&void 0!==d&&(m||a>=b&&d<=I&&o<=A&&o>=v)&&u[e].push({direction:g,index:t,edge:r,endsOnLine:i,endsOffLine:c,horizontal:m,startsOnLine:s,vertical:y,xmin:a,xmax:d,imageLineY:o})}}const A=m/2,b=p(v,m);u.forEach(((e,n)=>{if(e.length>0){const o=c(e,y).map(r),[s,a]=h(o,(t=>t.through));if(s.length%2==1)throw t>=1&&console.error("throughs:",JSON.stringify(s)),Error("throughs.length for "+n+" is odd with "+s.length);let l=a.map((t=>[t.xmin,t.xmax]));s.sort(((t,e)=>t.xmin-e.xmin));const u=i(s).map((t=>{const[e,n]=t;return[e.xmin,n.xmax]}));l=l.concat(u),l=f(l),l.forEach((t=>{const[e,o]=t;if(o-e<A)return;const[r,s]=b(t);if(r===s)return;if(r>g)return;if(s<=0)return;const i=Math.max(r,0),c=Math.min(s-1,g-1);if(_&&_({row:n,columns:[i,c]}),w)for(let t=i;t<=c;t++)w({row:n,column:t})}))}}))}))}}},801:(t,e,n)=>{const o=n(230),r=n(276),s=n(629);t.exports=function({debug:t=!1,raster_bbox:e,raster_height:n,raster_width:i,pixel_height:c,pixel_width:a,geometry:l,per_pixel:u,per_row_segment:f}){const[h,p,x,g]=e;null==c&&(c=(g-p)/n),null==a&&(a=(x-h)/i);const d=new Array(n);o({raster_bbox:e,raster_height:n,raster_width:i,pixel_height:c,pixel_width:a,geometry:l,per_pixel:u,per_row_segment:({row:t,columns:e})=>{d[t]||(d[t]=[]),d[t].push(e),f&&f({row:t,columns:e})}});for(let t=0;t<d.length;t++){const e=d[t];e&&(e.sort(((t,e)=>t===e?t[1]-e[1]:t[0]-e[0])),d[t]=s(e))}return t&&r(insides),{rows:d}}},240:t=>{t.exports=function(t){try{let e,n,o;const r=t.length,s=t[0];if(1===r)e=!0,n=s.xmin,o=s.xmax;else{const i=t[r-1];e=s.direction===i.direction,n=Math.min(s.xmin,i.xmin),o=Math.max(s.xmax,i.xmax)}if(void 0===n||void 0===o||void 0===e||isNaN(n)||isNaN(o))throw Error("categorizeIntersection failed with xmin",n,"and xmax",o);return{xmin:n,xmax:o,through:e}}catch(e){throw console.error("[categorizeIntersection] segments:",t),console.error("[categorizeIntersection]",e),e}}},276:t=>{t.exports=function(t){t.forEach(((t,e)=>{for(let n=0;n<t.length;n++){const o=t[n],[r,s]=o;r>s&&console.warn("[dufour-peyton-intersection] uh oh, encountered invalid range",o,"at row index",e,"with ranges",t);for(let o=n+1;o<t.length;o++)o[0]<=s&&console.warn("[dufour-peyton-intersection] encountered range problem on row index",e,":",t)}}))}},734:t=>{t.exports=function(t,e,n){return t<e?e:t>n?n:t}},614:(t,e,n)=>{const o=n(852);t.exports=function(t,e,n=!1){try{const n=o(t,(t=>t.endsOffLine));if(n.length>=2){const t=n[0],o=t[0],r=n[n.length-1],s=r[r.length-1];s.index===e-1&&0===o.index&&s.endsOnLine&&(n[0]=n.pop().concat(t))}return n}catch(t){console.error("[clusterLineSegments]",t)}}},852:t=>{t.exports=function(t,e){try{const n=t.length,o=[];let r=[];for(let s=0;s<n;s++){const n=t[s];r.push(n),e(n)&&(o.push(r),r=[])}return r.length>0&&o.push(r),o}catch(t){console.error("[cluster]:",t)}}},443:t=>{t.exports=function(t){const e=[],n=t.length;for(let o=0;o<n;o+=2)e.push([t[o],t[o+1]]);return e}},110:t=>{t.exports=function(t,e){t.forEach((t=>{for(let n=1;n<t.length;n++){const o=t[n-1],r=t[n];e([o,r],n-1)}}))}},942:(t,e,n)=>{const o=n(155);t.exports=function t(e,n){if("FeatureCollection"===e.type)e.features.forEach((e=>t(e,n)));else if("Feature"===e.type)t(e.geometry,n);else if("Polygon"===e.type)t(e.coordinates,n);else if("MultiPolygon"===e.type)e.coordinates.forEach((t=>{n(t)}));else if(Array.isArray(e)){const t=o(e);4===t?e.forEach((t=>{n(t)})):3===t&&n(e)}}},60:(t,e,n)=>{const o=n(942);t.exports=function(t){let e,n,r,s;return o(t,(t=>{const o=t[0],i=o.length-1;let c;for(void 0===e?(e=r=o[0][0],n=s=o[0][1],c=1):c=0;c<=i;c++){const[t,i]=o[c];t<e?e=t:t>r&&(r=t),i<n?n=i:i>s&&(s=i)}})),[e,n,r,s]}},666:(t,e,n)=>{const o=n(110);t.exports=function(t){const e=[];return o(t,(t=>e.push(t))),e}},360:t=>{t.exports=function(t,e){const n=t.a*e.b-e.a*t.b;if(n)return{x:(e.b*t.c-t.b*e.c)/n,y:(t.a*e.c-e.a*t.c)/n}}},557:t=>{t.exports=function(t,e){const[n,o]=t,[r,s]=e,i=s-o,c=n-r;return{a:i,b:c,c:i*n+c*o}}},955:(t,e,n)=>{const o=n(942);t.exports=function(t){const e=[];return o(t,(t=>e.push(t))),e}},138:(t,e,n)=>{var o;const r=n(240),s=n(734),i=n(852),c=n(614),a=n(801),l=n(230),u=n(443),f=n(60),h=n(955),p={calculate:a,calculateCore:l,categorizeIntersection:r,clamp:s,cluster:i,clusterLineSegments:c,couple:u,eachEdge:n(110),getBoundingBox:f,getIntersectionOfTwoLines:n(360),getLineFromPoints:n(557),getPolygons:h,mergeRanges:n(250),partition:n(732),prepareSnap:n(578),range:n(559),roundDown:n(828)};void 0===(o=(()=>p).call(e,n,e,t))||(t.exports=o),t.exports=p,"object"==typeof self&&(self.dufour_peyton_intersection=p),"object"==typeof window&&(window.dufour_peyton_intersection=p)},629:t=>{t.exports=function(t){const e=t.length;if(e>0){const n=t[0];let o=n[1];const r=[n];for(let n=1;n<e;n++){const e=t[n],[s,i]=e;s<=o+1?r[r.length-1][1]=i:r.push(e),o=i}return r}}},250:t=>{t.exports=function(t){const e=t.length;if(e>0){const n=t[0];let o=n[1];const r=[n];for(let n=1;n<e;n++){const e=t[n],[s,i]=e;s<=o?r[r.length-1][1]=i:r.push(e),o=i}return r}}},732:t=>{t.exports=function(t,e){const n=[],o=[],r=t.length;for(let s=0;s<r;s++){const r=t[s];e(r)?n.push(r):o.push(r)}return[n,o]}},578:(t,e,n)=>{const o=n(828);t.exports=function(t,e){return([n,r])=>(-0===(n=o((n-t)/e))&&(n=0),-0===(r=Math.round((r-t)/e))&&(r=0),[n,r])}},559:t=>{t.exports=function(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=n;return e}},828:t=>{t.exports=function(t){return-1*Math.round(-1*t)}}},e={};!function n(o){var r=e[o];if(void 0!==r)return r.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,n),s.exports}(138)})();
//# sourceMappingURL=dufour-peyton-intersection.min.js.map