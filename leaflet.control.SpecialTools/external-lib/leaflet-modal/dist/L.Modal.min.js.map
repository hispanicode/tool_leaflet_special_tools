{"version":3,"file":"L.Modal.min.js","sources":["../src/modal.js"],"sourcesContent":["import L from 'leaflet';\n\n/**\n * Modal handler\n * @class   {L.Map.Modal}\n * @extends {L.Mixin.Events}\n * @extends {L.Handler}\n */\nL.Map.Modal = L.Handler.extend( /** @lends {L.Map.Hadler.prototype} */ {\n\n  includes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\n\n  /**\n   * @static\n   * @type {Object}\n   */\n  statics: {\n    BASE_CLS: 'leaflet-modal',\n    HIDE: 'modal.hide',\n    SHOW_START: 'modal.showStart',\n    SHOW: 'modal.show',\n    CHANGED: 'modal.changed',\n    /**\n     * \"foo bar baz\" -> \".foo.bar.baz\"\n     * @param  {String} classString\n     * @return {String}\n     */\n    classNameToSelector: (classString) => {\n      return (' ' + classString).split(' ').join('.').replace(/^\\s+|\\s+$/g, '');\n    }\n  },\n\n  /**\n   * @type {Object}\n   */\n  options: {\n    OVERLAY_CLS: 'overlay',\n    MODAL_CLS: 'modal',\n    MODAL_CONTENT_CLS: 'modal-content',\n    INNER_CONTENT_CLS: 'modal-inner',\n    SHOW_CLS: 'show',\n    CLOSE_CLS: 'close',\n\n    closeTitle: 'close',\n    zIndex: 10000,\n    transitionDuration: 300,\n\n    wrapperTemplate: [\n      '<div class=\"{OVERLAY_CLS}\"></div>',\n      '<div class=\"{MODAL_CLS}\"><div class=\"{MODAL_CONTENT_CLS}\">',\n      '<span class=\"{CLOSE_CLS}\" title=\"{closeTitle}\">&times;</span>',\n      '<div class=\"{INNER_CONTENT_CLS}\">{_content}</div>',\n      '</div></div>'\n    ].join(''),\n\n    template: '{content}',\n    content: ''\n\n  },\n\n  /**\n   * @constructor\n   * @param  {L.Map}   map\n   * @param  {Object=} options\n   */\n  initialize: function(map, options) {\n    L.Handler.prototype.initialize.call(this, map);\n    L.Util.setOptions(this, options);\n\n    this._visible = false;\n\n    const container = this._container =\n      L.DomUtil.create('div', L.Map.Modal.BASE_CLS, map._container);\n    container.style.zIndex = this.options.zIndex;\n    container.style.position = 'absolute';\n    this._map._controlContainer.appendChild(container);\n\n    L.DomEvent\n      .disableClickPropagation(container)\n      .disableScrollPropagation(container);\n    L.DomEvent.on(container, 'contextmenu', L.DomEvent.stopPropagation);\n\n    this.enable();\n  },\n\n  /**\n   * Add events and keyboard handlers\n   */\n  addHooks: function() {\n    L.DomEvent.on(document, 'keydown', this._onKeyDown, this);\n    this._map.on({ modal: this._show }, this);\n  },\n\n  /**\n   * Disable handlers\n   */\n  removeHooks: function() {\n    L.DomEvent.off(document, 'keydown', this._onKeyDown, this);\n    this._map.off({ modal: this._show }, this);\n  },\n\n  /**\n   * @return {L.Map.Modal}\n   */\n  hide: function() {\n    this._hide();\n    return this;\n  },\n\n  /**\n   * @return {Boolean}\n   */\n  isVisible: function() {\n    return this._visible;\n  },\n\n  /**\n   * Show again, or just resize and re-position\n   * @param  {Object=} options\n   */\n  update: function(options) {\n    if (options) this._show(options);\n    else         this._updatePosition();\n  },\n\n  /**\n   * @param {String} content\n   */\n  setContent: function(content) {\n    this._getInnerContentContainer().innerHTML = content;\n    this.update();\n  },\n\n  /**\n   * Update container position\n   */\n  _updatePosition: function() {\n    const content = this._getContentContainer();\n    const { y } = this._map.getSize();\n    const { offsetHeight } = content;\n\n    if (offsetHeight < y) {\n      content.style.marginTop = ((y - offsetHeight) / 2) + 'px';\n    } else {\n      content.style.marginTop = '';\n    }\n  },\n\n  /**\n   * @param  {Object} options\n   */\n  _show: function(options) {\n    if (this._visible) this._hide();\n    options = L.Util.extend({}, this.options, options);\n\n    this._render(options);\n    this._setContainerSize(options);\n\n    this._updatePosition();\n\n    L.Util.requestAnimFrame(() => {\n      const contentContainer = this._getContentContainer();\n      L.DomEvent.on(contentContainer, 'transitionend', this._onTransitionEnd, this);\n      L.DomEvent.disableClickPropagation(contentContainer);\n      L.DomUtil.addClass(this._container, this.options.SHOW_CLS);\n\n      if (!L.Browser.any3d) {\n        L.Util.requestAnimFrame(this._onTransitionEnd, this);\n      }\n    });\n\n    const container = this._container;\n\n    const closeBtn = container.querySelector('.' + this.options.CLOSE_CLS);\n    if (closeBtn) {\n      L.DomEvent.on(closeBtn, 'click', this._onCloseClick, this);\n    }\n\n    const modal = container.querySelector('.' + this.options.MODAL_CLS);\n    if (modal) {\n      L.DomEvent.on(modal, 'mousedown', this._onMouseDown, this);\n    }\n\n    // callbacks\n    if (typeof options.onShow === 'function') {\n      this._map.once(L.Map.Modal.SHOW, options.onShow);\n    }\n\n    if (typeof options.onHide === 'function') {\n      this._map.once(L.Map.Modal.HIDE, options.onHide);\n    }\n\n    // fire event\n    this._map.fire(L.Map.Modal.SHOW_START, { modal: this });\n  },\n\n  /**\n   * Show transition ended\n   * @param  {TransitionEvent=} e\n   */\n  _onTransitionEnd: function(e) {\n    const data = { modal: this };\n    const map = this._map;\n    if (!this._visible) {\n      if (L.DomUtil.hasClass(this._container, this.options.SHOW_CLS)) {\n        this._visible = true;\n        map.fire(L.Map.Modal.SHOW, data);\n      } else {\n        map.fire(L.Map.Modal.HIDE, data);\n      }\n    } else {\n      map.fire(L.Map.Modal.CHANGED, data);\n    }\n  },\n\n  /**\n   * @param  {L.MouseEvent} evt\n   */\n  _onCloseClick: function(evt) {\n    L.DomEvent.stop(evt);\n    this._hide();\n  },\n\n  /**\n   * Render template\n   * @param  {Object} options\n   */\n  _render: function(options) {\n    this._container.innerHTML = L.Util.template(\n      options.wrapperTemplate,\n      L.Util.extend({}, options, {\n        _content: L.Util.template(options.template, options)\n      })\n    );\n    if (options.element) {\n      const contentContainer = this._container.querySelector(\n        L.Map.Modal.classNameToSelector(this.options.MODAL_CONTENT_CLS));\n      if (contentContainer) {\n        contentContainer.appendChild(options.element);\n      }\n    }\n  },\n\n  /**\n   * @return {Element}\n   */\n  _getContentContainer: function() {\n    return this._container.querySelector(\n      L.Map.Modal.classNameToSelector(this.options.MODAL_CONTENT_CLS));\n  },\n\n  /**\n   * Inner content, don't touch destroy button\n   * @return {Element}\n   */\n  _getInnerContentContainer: function() {\n    return this._container.querySelector(\n      L.Map.Modal.classNameToSelector(this.options.INNER_CONTENT_CLS))\n  },\n\n  /**\n   * @param {Object} options\n   * @param {Number} options.width\n   * @param {Number} options.height\n   */\n  _setContainerSize: function(options) {\n    const content = this._getContentContainer();\n\n    if (options.width) {\n      content.style.width = options.width + 'px';\n    }\n\n    if (options.height) {\n      content.style.height = options.height + 'px';\n    }\n  },\n\n  /**\n   * Hide blocks immediately\n   */\n  _hideInternal: function() {\n    this._visible = false;\n    L.DomUtil.removeClass(this._container, this.options.SHOW_CLS);\n  },\n\n  /**\n   * Hide modal\n   */\n  _hide: function() {\n    if (this._visible) {\n      this._hideInternal();\n      L.Util.requestAnimFrame(this._onTransitionEnd, this);\n    }\n  },\n\n  /**\n   * Mouse down on overlay\n   * @param  {L.MouseEvent} evt\n   */\n  _onMouseDown: function(evt) {\n    L.DomEvent.stop(evt);\n    const target = (evt.target || evt.srcElement);\n    if (L.DomUtil.hasClass(target, this.options.MODAL_CLS)) this._hide();\n  },\n\n  /**\n   * Key stroke(escape)\n   * @param  {KeyboardEvent} evt\n   */\n  _onKeyDown: function(evt) {\n    const key = evt.keyCode || evt.which;\n    if (key === 27) this._hide();\n  }\n\n});\n\n// register hook\nL.Map.addInitHook('addHandler', 'modal', L.Map.Modal);\n\nL.Map.include( /** @lends {L.Map.prototype} */ {\n\n  /**\n   * @param  {Object} options\n   * @return {L.Map}\n   */\n  openModal: function(options) {\n    return this.fire('modal', options);\n  },\n\n  /**\n   * @return {L.Map}\n   */\n  closeModal: function() {\n    this.modal.hide();\n    return this;\n  }\n});\n\nexport default L.Map.Modal;\n"],"names":["Map","Modal","L","Handler","extend","includes","Evented","prototype","Mixin","Events","statics","BASE_CLS","HIDE","SHOW_START","SHOW","CHANGED","classNameToSelector","classString","split","join","replace","options","OVERLAY_CLS","MODAL_CLS","MODAL_CONTENT_CLS","INNER_CONTENT_CLS","SHOW_CLS","CLOSE_CLS","closeTitle","zIndex","transitionDuration","wrapperTemplate","template","content","initialize","map","call","this","Util","setOptions","_visible","const","container","_container","DomUtil","create","style","position","_map","_controlContainer","appendChild","DomEvent","disableClickPropagation","disableScrollPropagation","on","stopPropagation","enable","addHooks","document","_onKeyDown","modal","_show","removeHooks","off","hide","_hide","isVisible","update","_updatePosition","setContent","_getInnerContentContainer","innerHTML","_getContentContainer","getSize","marginTop","offsetHeight","y","_render","_setContainerSize","requestAnimFrame","contentContainer","_onTransitionEnd","addClass","Browser","any3d","closeBtn","querySelector","_onCloseClick","_onMouseDown","onShow","once","onHide","fire","e","data","hasClass","evt","stop","_content","element","width","height","_hideInternal","removeClass","target","srcElement","keyCode","which","addInitHook","include","openModal","closeModal"],"mappings":"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"}